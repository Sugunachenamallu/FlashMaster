<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlashMaster - Create Topic</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <link rel="stylesheet" href="create.css" />
</head>
<body>
    <div class="stars" id="stars"></div>

    <!-- <div class="main-content">
        <nav class="navbar">
            <div class="container1">
                <div class="brand">FlashMaster</div>
                <div class="menubar" tabindex="0" aria-label="Menu" onclick="toggleMenu()" onkeypress="if(event.key==='Enter'){toggleMenu();}">☰</div>
                <ul class="nav-links" id="navMenu">
                    <li><a href="HomePage.html">Home</a></li>
                    <li><a href="modules.html">Modules</a></li>
                    
                    <li class="create-dropdown" onclick="toggleCreateDropdown(event)">
                        <a href="javascript:void(0)">Create</a>
                        <ul class="dropdown-menu" id="createDropdownMenu">
                            <li><a href="create.html">Add Topic</a></li>
                            <li><a href="addCard.html">Add Cards</a></li>
                        </ul>
                    </li>

                    <li><a href="todo.html">To-do List</a></li>

                    <li class="user-dropdown" onclick="toggleUserDropdown(event)">
                        <i class="fa-solid fa-circle-user user-icon"></i>
                        <ul class="dropdown-menu" id="userDropdownMenu">
                            <li><a href="myTopics.html">My Topics</a></li>
                            <li><a href="contact.html">Contact</a></li>
                            <li><a href="account.html">Account</a></li>
                            <li><a href="logout.html">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav> -->

<nav class="navbar">
    <div class="container1">
      <div class="brand"><strong>FlashMaster</strong></div>
      <div class="menubar" onclick="toggleMenu()">☰</div>
      <ul class="nav-links" id="navMenu">
        <li><a  href="HomePage.html">Home</a></li>
        <li><a href="modules.html">Modules</a></li>
        <!-- CREATE DROPDOWN -->
        <li class="create-dropdown" onclick="toggleCreate(event)">
          <a href="javascript:void(0)">Create</a>
          <ul class="dropdown-menu" id="createDropdown">
            <li><a href="create.html">Add Topic</a></li>
            <li><a href="addCard.html">Add Cards</a></li>
          </ul>
        </li>

        <li><a href="progress.html">To-do List</a></li>

        <!-- USER DROPDOWN -->
        <li class="user-dropdown" onclick="toggleDropdown(event)">
          <i class="fa-solid fa-circle-user user-icon"></i>
          <ul class="dropdown-menu" id="dropdownMenu">
            <li><a href="myTopics.html">My Topics</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="account.html">Add Account</a></li>
            <li><a href="logout.html">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>


        <div class="page-header">
            <h1>Create Your Own Flashcards</h1>
            <p>Design your cosmic revision journey!</p>
        </div>

        <div class="create-form-section">
            <div class="form-group">
                <label for="topicName">Topic Name:</label>
                <input type="text" id="topicName" placeholder="e.g., Data Structures, Space Facts" />
            </div>
            <div class="form-group">
                <label for="numCards">Number of Flashcards:</label>
                <input type="number" id="numCards" min="1" value="5" />
            </div>
            <div class="form-group color-picker-group">
                <label for="frontColor">Front Card Color:</label>
                <input type="color" id="frontColor" value="#1f006b" />
            </div>
            <div class="form-group color-picker-group">
                <label for="backColor">Back Card Color:</label>
                <input type="color" id="backColor" value="#3b00a0" />
            </div>
            <button id="generateCardsBtn" class="action-button">Generate Cards</button>
        </div>

        <div class="flashcard-editor-area">
            <div id="flashcardEditorContainer" class="flashcard-grid">
                </div>
            <button id="saveFlashcardsBtn" class="action-button save-button" style="display: none;">Save Flashcards</button>
            <div id="messageBox" class="message-box" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Starfield background generation
        const stars = document.getElementById("stars");
        for (let i = 0; i < 100; i++) {
            const star = document.createElement("div");
            star.classList.add("star");
            star.style.top = `${Math.random() * 100}vh`;
            star.style.left = `${Math.random() * 100}vw`;
            star.style.animationDuration = `${Math.random() * 3 + 2}s`;
            stars.appendChild(star);
        }

        // --- Navbar Dropdown Toggles (consistent across pages) ---
    // Function to toggle the user dropdown menu
    function toggleDropdown(event) {
    const dropdownMenu = document.getElementById('dropdownMenu');
    dropdownMenu.classList.toggle('show');
    event.stopPropagation(); // Prevents the body click listener from immediately closing it
    }

    // Function to toggle the create dropdown menu
    function toggleCreate(event) {
    const createDropdown = document.getElementById('createDropdown');
    createDropdown.classList.toggle('show');
    event.stopPropagation(); // Prevents the body click listener from immediately closing it
    }

    // Function to close all dropdowns when clicking outside
    document.body.addEventListener('click', () => {
    const dropdownMenus = document.querySelectorAll('.dropdown-menu');
    dropdownMenus.forEach(menu => {
        menu.classList.remove('show');
    });
    });

        // Close all dropdowns and mobile menu if clicked outside
        document.addEventListener("click", function (e) {
            const createDropdown = document.getElementById("createDropdownMenu");
            const createDropdownParent = document.querySelector(".create-dropdown");

            const userDropdown = document.getElementById("userDropdownMenu");
            const userDropdownParent = document.querySelector(".user-dropdown");

            if (createDropdown && !createDropdownParent.contains(e.target)) {
                createDropdown.classList.remove("show");
            }
            if (userDropdown && !userDropdownParent.contains(e.target)) {
                userDropdown.classList.remove("show");
            }

            const navMenu = document.getElementById('navMenu');
            const menubar = document.querySelector('.menubar'); // The hamburger icon
            // Only close main nav if it's open AND click is outside menu AND outside menubar itself
            if (navMenu.classList.contains('show') && !navMenu.contains(e.target) && !menubar.contains(e.target)) {
                navMenu.classList.remove('show');
            }
        });


        // --- Page Specific JavaScript for Create/Add Topic ---
        document.addEventListener("DOMContentLoaded", () => {
            const topicNameInput = document.getElementById("topicName");
            const numCardsInput = document.getElementById("numCards");
            const frontColorInput = document.getElementById("frontColor");
            const backColorInput = document.getElementById("backColor");
            const generateCardsBtn = document.getElementById("generateCardsBtn");
            const flashcardEditorContainer = document.getElementById("flashcardEditorContainer");
            const saveFlashcardsBtn = document.getElementById("saveFlashcardsBtn");
            const messageBox = document.getElementById("messageBox");

            let currentTopicId = null; // Holds the ID of the topic being edited

            function showMessage(message, type = 'success') {
                messageBox.textContent = message;
                messageBox.className = 'message-box';
                messageBox.classList.add(type);
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 3000);
            }

            function darkenColor(hex, percent) {
                let f = parseInt(hex.slice(1), 16),
                    t = percent < 0 ? 0 : 255,
                    p = percent < 0 ? percent * -1 : percent,
                    R = f >> 16,
                    G = (f >> 8) & 0x00ff,
                    B = f & 0x0000ff;
                return "#" + (
                    0x1000000 + (Math.round((t - R) * p) + R) * 0x10000 +
                    (Math.round((t - G) * p) + G) * 0x100 +
                    (Math.round((t - B) * p) + B)
                ).toString(16).slice(1);
            }

            function renderFlashcards(cardsData, topicColors) {
                flashcardEditorContainer.innerHTML = '';

                if (cardsData.length > 0) {
                    saveFlashcardsBtn.style.display = 'block';
                } else {
                    saveFlashcardsBtn.style.display = 'none';
                }

                cardsData.forEach((card, i) => {
                    const cardDiv = document.createElement("div");
                    cardDiv.classList.add("flashcard-editor");

                    cardDiv.style.setProperty('--front-card-color', topicColors.frontColor);
                    cardDiv.style.setProperty('--back-card-color', topicColors.backColor);
                    cardDiv.style.setProperty('--front-card-color-darker', darkenColor(topicColors.frontColor, -0.2));
                    cardDiv.style.setProperty('--back-card-color-darker', darkenColor(topicColors.backColor, -0.2));

                    cardDiv.innerHTML = `
                        <div class="flashcard-editor-inner">
                            <div class="front-editor">
                                <label for="question-${i}">Question ${i + 1}:</label>
                                <textarea id="question-${i}" placeholder="Enter question...">${card.question || ''}</textarea>
                                <button type="button" class="flip-card-button">Flip</button>
                            </div>
                            <div class="back-editor">
                                <label for="answer-${i}">Answer ${i + 1}:</label>
                                <textarea id="answer-${i}" placeholder="Enter answer...">${card.answer || ''}</textarea>
                                <button type="button" class="flip-card-button">Flip</button>
                            </div>
                        </div>
                    `;
                    flashcardEditorContainer.appendChild(cardDiv);

                    const flipButtons = cardDiv.querySelectorAll(".flip-card-button");
                    flipButtons.forEach(button => {
                        button.addEventListener("click", (event) => {
                            event.stopPropagation();
                            cardDiv.querySelector(".flashcard-editor-inner").classList.toggle("flipped");
                        });
                    });
                });
            }

            generateCardsBtn.addEventListener("click", () => {
                const topicName = topicNameInput.value.trim();
                const numCards = parseInt(numCardsInput.value, 10);
                const frontColor = frontColorInput.value;
                const backColor = backColorInput.value;

                if (!topicName) {
                    showMessage("Please enter a Topic Name.", "error");
                    return;
                }
                if (isNaN(numCards) || numCards <= 0) {
                    showMessage("Please enter a valid number of cards (at least 1).", "error");
                    return;
                }

                currentTopicId = null; // When generating new cards, reset to a new topic state
                
                const newCards = Array.from({ length: numCards }, () => ({ question: '', answer: '' }));
                renderFlashcards(newCards, { frontColor, backColor });
                showMessage(`Generated ${numCards} flashcards for "${topicName}".`);
            });

            const loadFlashcardsFromStorage = () => {
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const topicIdParam = urlParams.get('topicId');

                    let allTopics = JSON.parse(localStorage.getItem('flashmaster_custom_topics')) || [];
                    let topicToLoad = null;

                    if (topicIdParam) {
                        topicToLoad = allTopics.find(t => t.id === parseInt(topicIdParam));
                        if (topicToLoad) {
                            currentTopicId = topicToLoad.id;
                            topicNameInput.value = topicToLoad.topicName;
                            numCardsInput.value = topicToLoad.cards.length;
                            frontColorInput.value = topicToLoad.frontColor;
                            backColorInput.value = topicToLoad.backColor;
                            renderFlashcards(topicToLoad.cards, { frontColor: topicToLoad.frontColor, backColor: topicToLoad.backColor });
                            showMessage(`Loaded flashcards for topic "${topicToLoad.topicName}".`);
                            return; // Exit after loading specific topic
                        }
                    }
                    
                    // If no specific topic loaded from URL or if topic not found, provide a clean slate
                    currentTopicId = null;
                    topicNameInput.value = '';
                    numCardsInput.value = 5; // Default number of cards
                    frontColorInput.value = '#1f006b'; // Default colors
                    backColorInput.value = '#3b00a0';
                    flashcardEditorContainer.innerHTML = ''; // Clear flashcards
                    saveFlashcardsBtn.style.display = 'none';
                    showMessage("Ready to create a new topic!", "info");
                    
                } catch (e) {
                    console.error("Error loading from local storage:", e);
                    showMessage("Failed to load flashcards. Data might be corrupted.", "error");
                }
            };

            loadFlashcardsFromStorage(); // Call on initial load

            saveFlashcardsBtn.addEventListener("click", () => {
                const topicName = topicNameInput.value.trim();
                if (!topicName) {
                    showMessage("Topic Name cannot be empty when saving!", "error");
                    return;
                }

                const flashcards = [];
                const cardElements = flashcardEditorContainer.querySelectorAll(".flashcard-editor");

                if (cardElements.length === 0) {
                    showMessage("No flashcards to save. Generate cards first!", "error");
                    return;
                }

                cardElements.forEach((cardElement, index) => {
                    const questionTextarea = cardElement.querySelector(`#question-${index}`);
                    const answerTextarea = cardElement.querySelector(`#answer-${index}`);

                    const question = questionTextarea ? questionTextarea.value.trim() : '';
                    const answer = answerTextarea ? answerTextarea.value.trim() : '';

                    if (question || answer) {
                        flashcards.push({ question, answer });
                    }
                });

                if (flashcards.length === 0) {
                    showMessage("No content to save. Please fill in some questions/answers.", "error");
                    return;
                }

                let allTopics = JSON.parse(localStorage.getItem('flashmaster_custom_topics')) || [];
                
                let topicData = {
                    id: currentTopicId || Date.now(),
                    topicName: topicName,
                    cards: flashcards,
                    frontColor: frontColorInput.value,
                    backColor: backColorInput.value,
                    lastModified: new Date().toISOString()
                };

                if (currentTopicId) {
                    const existingTopicIndex = allTopics.findIndex(t => t.id === currentTopicId);
                    if (existingTopicIndex > -1) {
                        allTopics[existingTopicIndex] = topicData;
                        showMessage(`Topic "${topicName}" updated successfully!`);
                    } else {
                        allTopics.push(topicData);
                        showMessage(`Topic "${topicName}" saved as new (ID mismatch)!`);
                    }
                } else {
                    const existingTopicByName = allTopics.find(t => t.topicName.toLowerCase() === topicName.toLowerCase());
                    if (existingTopicByName) {
                        showMessage(`A topic named "${topicName}" already exists. Please choose a different name or edit the existing topic from "My Topics".`, "error");
                        return;
                    }
                    allTopics.push(topicData);
                    currentTopicId = topicData.id;
                    showMessage(`Topic "${topicName}" saved successfully!`);
                }
                
                localStorage.setItem('flashmaster_custom_topics', JSON.stringify(allTopics));
            });
        });

        // Expose toggleMenu globally if it's used in HTML onclick attributes
        // (These are now redundant since they are inside the DOMContentLoaded, but kept for clarity)
        window.toggleMenu = toggleMenu;
        window.toggleCreateDropdown = toggleCreateDropdown;
        window.toggleUserDropdown = toggleUserDropdown;
    </script>
</body>
</html>